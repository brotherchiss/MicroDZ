<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MicroDZ Login</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background-color: #f6f8fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }
        .microdz-card {
            background-color: #ffffff;
            border: 1px solid #d0d7de;
            border-radius: 6px;
        }
        .btn-green {
            background-color: #2da44e;
            color: white;
        }
        .btn-green:hover {
            background-color: #2c974b;
        }
        .btn-blue {
            background-color: #0969da;
            color: white;
        }
        .btn-blue:hover {
            background-color: #0860ca;
        }
        .btn-yellow {
            background-color: #d69e2e;
            color: white;
        }
        .btn-yellow:hover {
            background-color: #b7791f;
        }
        .input-field {
            border: 1px solid #d0d7de;
        }
        .input-field:focus {
            border-color: #0969da;
            outline: none;
            box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.3);
        }
        .hidden {
            display: none;
        }
    </style>
</head>

<body class="flex flex-col items-center justify-center min-h-screen p-4">

<h1 class="text-3xl font-bold mb-8 text-gray-800 cursor-pointer" onclick="location.reload()">MicroDZ</h1>

<div class="w-full max-w-[340px]">

    <!-- STATUS -->
    <div id="status" class="hidden"></div>

    <!-- LOGIN -->
    <div id="loginSection">
        <div class="microdz-card p-6 mb-4 shadow-sm">
            <h2 class="text-lg font-semibold mb-4">Masuk</h2>

            <form id="loginForm">
                <div class="mb-3">
                    <label class="text-sm">Email</label>
                    <input id="loginEmail" type="email" class="input-field w-full px-3 py-2 rounded text-sm" required />
                </div>

                <div class="mb-4">
                    <label class="text-sm">Password</label>
                    <input id="loginPassword" type="password" class="input-field w-full px-3 py-2 rounded text-sm" required />
                </div>

                <button class="btn-green w-full py-2 rounded text-sm font-semibold">Login</button>
            </form>
        </div>

        <div class="microdz-card p-4 text-center text-sm">
            Baru di MicroDZ?
            <a href="#" id="showRegister" class="text-blue-600">Buat akun</a> | 
            <a href="#" id="showForgot" class="text-blue-600">Lupa password?</a>
        </div>
    </div>

    <!-- REGISTER -->
    <div id="registerSection" class="hidden">
        <div class="microdz-card p-6 mb-4 shadow-sm">
            <h2 class="text-lg font-semibold mb-4">Daftar Akun</h2>

            <form id="registerForm">
                <div class="mb-3">
                    <label class="text-sm">Email</label>
                    <input id="regEmail" type="email" class="input-field w-full px-3 py-2 rounded text-sm" required />
                </div>

                <div class="mb-4">
                    <label class="text-sm">Password</label>
                    <input id="regPassword" type="password" class="input-field w-full px-3 py-2 rounded text-sm" required />
                </div>

                <button class="btn-blue w-full py-2 rounded text-sm font-semibold">Daftar</button>
            </form>
        </div>

        <div class="text-center text-sm">
            <a href="#" id="backToLoginFromRegister" class="text-blue-600">Kembali ke login</a>
        </div>
    </div>

    <!-- FORGOT PASSWORD -->
    <div id="forgotSection" class="hidden">
        <div class="microdz-card p-6 mb-4 shadow-sm">
            <h2 class="text-lg font-semibold mb-4">Reset Password</h2>

            <form id="forgotForm">
                <div class="mb-4">
                    <label class="text-sm">Masukkan email Anda</label>
                    <input id="forgotEmail" type="email" class="input-field w-full px-3 py-2 rounded text-sm" required />
                </div>

                <button class="btn-yellow w-full py-2 rounded text-sm font-semibold">Kirim Link Reset Password</button>
            </form>
        </div>

        <div class="text-center text-sm">
            <a href="#" id="backToLoginFromForgot" class="text-blue-600">Kembali ke login</a>
        </div>
    </div>

</div>

<p class="mt-8 text-xs text-gray-500">Â© 2025 MicroDZ</p>

<!-- FIREBASE SCRIPT -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
    getAuth,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
    getFirestore,
    doc,
    setDoc,
    getDoc,
    serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
    apiKey: "AIzaSyBUH3svPecRr-75zmHA3kYJ-ypDeuZzey0",
    authDomain: "microdz-login.firebaseapp.com",
    projectId: "microdz-login",
    appId: "1:407509494952:web:c1e8d31bf39ec05847669d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ================= UI HANDLER ================= */
const status = document.getElementById("status");
const loginSection = document.getElementById("loginSection");
const registerSection = document.getElementById("registerSection");
const forgotSection = document.getElementById("forgotSection");

function showStatus(msg, error = true) {
    status.textContent = msg;
    status.className = error
        ? "block p-3 mb-4 text-sm bg-red-50 border border-red-200 text-red-800 rounded"
        : "block p-3 mb-4 text-sm bg-green-50 border border-green-200 text-green-800 rounded";
}

function hideAll() {
    loginSection.classList.add("hidden");
    registerSection.classList.add("hidden");
    forgotSection.classList.add("hidden");
    status.classList.add("hidden");
}

/* ================= NAV ================= */
document.getElementById("showRegister").onclick = e => {
    e.preventDefault();
    hideAll();
    registerSection.classList.remove("hidden");
};

document.getElementById("backToLoginFromRegister").onclick = e => {
    e.preventDefault();
    hideAll();
    loginSection.classList.remove("hidden");
};

document.getElementById("showForgot").onclick = e => {
    e.preventDefault();
    hideAll();
    forgotSection.classList.remove("hidden");
};

document.getElementById("backToLoginFromForgot").onclick = e => {
    e.preventDefault();
    hideAll();
    loginSection.classList.remove("hidden");
};

/* ================= LOGIN ================= */
document.getElementById("loginForm").addEventListener("submit", async e => {
    e.preventDefault();

    const email = loginEmail.value;
    const password = loginPassword.value;

    try {
        const cred = await signInWithEmailAndPassword(auth, email, password);
        const uid = cred.user.uid;

        const snap = await getDoc(doc(db, "users", uid));
        if (!snap.exists()) {
            showStatus("Data user tidak ditemukan di database");
            return;
        }

        const role = snap.data().role;
        if (role === "admin") {
            location.href = "admin-dashboard.html";
        } else {
            location.href = "user-dashboard.html";
        }

    } catch (err) {
        showStatus(err.message);
    }
});

/* ================= REGISTER ================= */
document.getElementById("registerForm").addEventListener("submit", async e => {
    e.preventDefault();

    const email = regEmail.value;
    const password = regPassword.value;

    try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        const user = cred.user;

        await setDoc(doc(db, "users", user.uid), {
            email: user.email,
            role: "user",
            status: "active",
            createdAt: serverTimestamp()
        });

        showStatus("Akun berhasil dibuat. Silakan login.", false);

        setTimeout(() => {
            hideAll();
            loginSection.classList.remove("hidden");
        }, 1500);

    } catch (err) {
        showStatus(err.message);
    }
});

/* ================= FORGOT PASSWORD ================= */
document.getElementById("forgotForm").addEventListener("submit", async e => {
    e.preventDefault();

    const email = forgotEmail.value;

    try {
        await sendPasswordResetEmail(auth, email);
        showStatus("Link reset password telah dikirim ke email Anda.", false);

        setTimeout(() => {
            hideAll();
            loginSection.classList.remove("hidden");
        }, 3000);

    } catch (err) {
        showStatus(err.message);
    }
});
</script>

</body>
</html>
