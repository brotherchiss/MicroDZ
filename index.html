<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicroDZ Control Hub</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #00f2ff; /* Cyan Neon */
            --secondary: #7000ff; /* Purple Neon */
            --bg-base: #05070a;
            --card-bg: rgba(13, 17, 23, 0.8);
        }

        body {
            background-color: var(--bg-base);
            font-family: 'Space Grotesk', sans-serif;
            color: #e2e8f0;
            overflow: hidden;
            background-image: 
                linear-gradient(rgba(0, 242, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 242, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* Scanline Effect */
        body::before {
            content: " ";
            position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 100;
            background-size: 100% 4px, 3px 100%;
            pointer-events: none;
        }

        .cyber-card {
            background: var(--card-bg);
            border: 1px solid rgba(0, 242, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.1), inset 0 0 10px rgba(0, 242, 255, 0.05);
            backdrop-filter: blur(10px);
            position: relative;
            clip-path: polygon(0 0, 95% 0, 100% 5%, 100% 100%, 5% 100%, 0 95%);
        }

        .cyber-input {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 242, 255, 0.3);
            color: var(--primary);
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
        }

        .cyber-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.4);
            background: rgba(0, 242, 255, 0.05);
        }

        .btn-cyber {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .btn-cyber:hover {
            background: var(--primary);
            color: black;
            box-shadow: 0 0 30px var(--primary);
        }

        .btn-cyber-alt {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .btn-cyber-alt:hover {
            background: var(--secondary);
            color: white;
            box-shadow: 0 0 30px var(--secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 10px var(--primary);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        .hidden { display: none; }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-6">

    <!-- System Header -->
    <header class="mb-10 text-center relative">
        <div class="flex items-center justify-center space-x-3 mb-2">
            <div class="status-dot"></div>
            <span class="text-[10px] tracking-[0.4em] font-bold text-cyan-400">SYSTEM ONLINE</span>
        </div>
        <h1 class="text-5xl font-black tracking-tighter text-white">
            MICRO<span class="text-cyan-400">DZ</span>
        </h1>
        <p class="text-[10px] text-gray-500 tracking-[0.3em] mt-1">AUTOMATED MONITORING INTERFACE</p>
    </header>

    <div class="w-full max-w-md relative">
        <!-- Floating Terminal Decor -->
        <div class="absolute -top-6 -left-6 text-[8px] text-cyan-500/40 font-mono hidden md:block">
            > DEVICE_ID: 882-QX<br>
            > STATUS: READY<br>
            > ENCRYPTION: AES-256
        </div>

        <div id="status" class="hidden transform transition-all mb-4"></div>

        <!-- MAIN CARD -->
        <div class="cyber-card p-8 md:p-10">
            
            <!-- LOGIN SECTION -->
            <div id="loginSection">
                <div class="mb-8 flex justify-between items-end">
                    <div>
                        <h2 class="text-xl font-bold text-white uppercase tracking-tight">Access Portal</h2>
                        <p class="text-gray-500 text-xs">Authorize to control devices</p>
                    </div>
                    <span class="text-[10px] font-mono text-cyan-500/50">SEC-V3</span>
                </div>

                <form id="loginForm" class="space-y-6">
                    <div>
                        <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest block mb-2">Admin Identity</label>
                        <input id="loginEmail" type="email" placeholder="ADMIN_EMAIL" 
                            class="cyber-input w-full px-4 py-3 rounded-sm text-sm" required>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest block mb-2">Security Key</label>
                        <input id="loginPassword" type="password" placeholder="••••••••" 
                            class="cyber-input w-full px-4 py-3 rounded-sm text-sm" required>
                    </div>

                    <button type="submit" class="btn-cyber w-full py-4 font-bold text-xs mt-4">
                        Initialize Session
                    </button>
                </form>

                <div class="mt-8 grid grid-cols-2 gap-4">
                    <button id="showRegister" class="text-[10px] text-gray-500 hover:text-cyan-400 text-left uppercase font-bold tracking-tighter transition-colors">
                        [ New Identity ]
                    </button>
                    <button id="showForgot" class="text-[10px] text-gray-500 hover:text-cyan-400 text-right uppercase font-bold tracking-tighter transition-colors">
                        [ Reset Key ]
                    </button>
                </div>
            </div>

            <!-- REGISTER SECTION -->
            <div id="registerSection" class="hidden">
                <h2 class="text-xl font-bold text-white uppercase mb-6">Create Identity</h2>
                <form id="registerForm" class="space-y-6">
                    <input id="regEmail" type="email" placeholder="EMAIL_ADDRESS" class="cyber-input w-full px-4 py-3 rounded-sm text-sm" required>
                    <input id="regPassword" type="password" placeholder="PASSWORD_MIN_6" class="cyber-input w-full px-4 py-3 rounded-sm text-sm" required>
                    <button type="submit" class="btn-cyber btn-cyber-alt w-full py-4 font-bold text-xs">Deploy Identity</button>
                </form>
                <button id="backToLoginFromRegister" class="mt-6 text-[10px] text-gray-500 hover:text-white uppercase w-full">Back to Base</button>
            </div>

            <!-- FORGOT SECTION -->
            <div id="forgotSection" class="hidden">
                <h2 class="text-xl font-bold text-white uppercase mb-6">Reset Protocol</h2>
                <form id="forgotForm" class="space-y-6">
                    <input id="forgotEmail" type="email" placeholder="REGISTERED_EMAIL" class="cyber-input w-full px-4 py-3 rounded-sm text-sm" required>
                    <button type="submit" class="btn-cyber w-full py-4 font-bold text-xs">Request Reset Link</button>
                </form>
                <button id="backToLoginFromForgot" class="mt-6 text-[10px] text-gray-500 hover:text-white uppercase w-full font-mono">Abort Mission</button>
            </div>

        </div>
    </div>

    <footer class="mt-12 opacity-30 pointer-events-none">
        <p class="text-[8px] font-mono tracking-[0.5em]">DATALINK ESTABLISHED // MICRODZ_v2.5</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, 
            sendPasswordResetEmail, onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, setDoc, getDoc, serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        /* CONFIG */
        const firebaseConfig = {
            apiKey: "AIzaSyBUH3svPecRr-75zmHA3kYJ-ypDeuZzey0",
            authDomain: "microdz-login.firebaseapp.com",
            projectId: "microdz-login",
            appId: "1:407509494952:web:c1e8d31bf39ec05847669d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = "microdz-monitor";

        /* UI ELEMENTS */
        const status = document.getElementById("status");
        const sections = {
            login: document.getElementById("loginSection"),
            register: document.getElementById("registerSection"),
            forgot: document.getElementById("forgotSection")
        };

        function showStatus(msg, error = true) {
            status.textContent = msg;
            status.className = error 
                ? "block p-4 mb-4 text-[10px] font-mono bg-red-900/20 border-l-4 border-red-500 text-red-400 uppercase"
                : "block p-4 mb-4 text-[10px] font-mono bg-cyan-900/20 border-l-4 border-cyan-500 text-cyan-400 uppercase";
            status.classList.remove("hidden");
        }

        function switchSection(target) {
            Object.values(sections).forEach(s => s.classList.add("hidden"));
            sections[target].classList.remove("hidden");
            status.classList.add("hidden");
        }

        /* EVENTS */
        document.getElementById("showRegister").onclick = () => switchSection('register');
        document.getElementById("showForgot").onclick = () => switchSection('forgot');
        document.getElementById("backToLoginFromRegister").onclick = () => switchSection('login');
        document.getElementById("backToLoginFromForgot").onclick = () => switchSection('login');

        /* LOGIN */
        document.getElementById("loginForm").onsubmit = async (e) => {
            e.preventDefault();
            const email = loginEmail.value;
            const password = loginPassword.value;
            try {
                const cred = await signInWithEmailAndPassword(auth, email, password);
                const userRef = doc(db, 'artifacts', appId, 'users', cred.user.uid, 'profile', 'data');
                const snap = await getDoc(userRef);
                
                if (snap.exists() && snap.data().role === "admin") {
                    window.location.href = "admin-dashboard.html";
                } else {
                    window.location.href = "user-dashboard.html";
                }
            } catch (err) { showStatus(err.message); }
        };

        /* REGISTER */
        document.getElementById("registerForm").onsubmit = async (e) => {
            e.preventDefault();
            try {
                const cred = await createUserWithEmailAndPassword(auth, regEmail.value, regPassword.value);
                const userRef = doc(db, 'artifacts', appId, 'users', cred.user.uid, 'profile', 'data');
                await setDoc(userRef, {
                    email: cred.user.email,
                    role: "user",
                    createdAt: serverTimestamp()
                });
                showStatus("Identity Registered. Return to base to login.", false);
            } catch (err) { showStatus(err.message); }
        };

        /* FORGOT */
        document.getElementById("forgotForm").onsubmit = async (e) => {
            e.preventDefault();
            try {
                await sendPasswordResetEmail(auth, forgotEmail.value);
                showStatus("Reset link transmitted to email.", false);
            } catch (err) { showStatus(err.message); }
        };
    </script>
</body>
</html>
